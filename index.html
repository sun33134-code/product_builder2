<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‚¬ì£¼íŒ”ì ë¶„ì„ê¸°</title>
<style>
:root {
  --wood: #2E7D32; --fire: #C62828; --earth: #E65100; --metal: #546E7A; --water: #1565C0;
  --bg: #FFF8F0; --card: #FFFFFF; --text: #3C2415; --accent: #8B1A1A; --gold: #B8860B;
  --border: #E0D5C8;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background: var(--bg); color: var(--text); line-height:1.6; }
.container { max-width:800px; margin:0 auto; padding:20px; }
header { text-align:center; padding:40px 0 30px; }
header h1 { font-size:2.2em; color:var(--accent); margin-bottom:4px; }
header h1 span { font-size:0.5em; color:var(--gold); display:block; margin-top:4px; letter-spacing:6px; }
header p { color:#888; font-size:0.95em; }
.form-card { background:var(--card); border-radius:12px; padding:28px; box-shadow:0 2px 12px rgba(0,0,0,0.06); border:1px solid var(--border); margin-bottom:24px; }
.form-row { display:flex; gap:12px; flex-wrap:wrap; align-items:end; }
.form-group { flex:1; min-width:100px; }
.form-group label { display:block; font-size:0.85em; color:#888; margin-bottom:4px; font-weight:500; }
.form-group select, .form-group input { width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:8px; font-size:1em; background:#FAFAFA; color:var(--text); }
.form-group select:focus, .form-group input:focus { outline:none; border-color:var(--accent); background:#FFF; }
.btn { background:var(--accent); color:#FFF; border:none; padding:11px 32px; border-radius:8px; font-size:1em; cursor:pointer; font-weight:600; transition:background 0.2s; white-space:nowrap; }
.btn:hover { background:#A52020; }
#results { display:none; }
.section { background:var(--card); border-radius:12px; padding:24px; box-shadow:0 2px 12px rgba(0,0,0,0.06); border:1px solid var(--border); margin-bottom:20px; }
.section h2 { font-size:1.15em; color:var(--accent); margin-bottom:16px; padding-bottom:8px; border-bottom:2px solid var(--border); }
.section h2 span.hanja { font-weight:400; color:var(--gold); font-size:0.85em; margin-left:6px; }
/* Pillar table */
.pillar-table { display:flex; justify-content:center; gap:0; }
.pillar { text-align:center; min-width:90px; border:1px solid var(--border); }
.pillar .label { background:#F5F0EA; padding:6px; font-size:0.85em; font-weight:600; color:#888; border-bottom:1px solid var(--border); }
.pillar .stem, .pillar .branch { padding:14px 8px; font-size:1.8em; font-weight:700; }
.pillar .stem { border-bottom:1px solid var(--border); }
.pillar .sub { font-size:0.38em; display:block; font-weight:400; color:#999; margin-top:2px; }
.pillar .ilgan-marker { background:var(--accent); color:#FFF; }
.pillar .ilgan-marker .sub { color:#ffcdd2; }
.el-wood { color:var(--wood); } .el-fire { color:var(--fire); } .el-earth { color:var(--earth); } .el-metal { color:var(--metal); } .el-water { color:var(--water); }
/* ì˜¤í–‰ chart */
.ohaeng-chart { margin:12px 0; }
.ohaeng-row { display:flex; align-items:center; margin-bottom:8px; gap:8px; }
.ohaeng-label { width:60px; font-weight:600; font-size:0.95em; text-align:right; }
.ohaeng-bar-bg { flex:1; background:#F0EBE3; border-radius:6px; height:26px; overflow:hidden; }
.ohaeng-bar { height:100%; border-radius:6px; transition:width 0.6s ease; display:flex; align-items:center; padding-left:8px; }
.ohaeng-bar span { color:#FFF; font-size:0.8em; font-weight:600; text-shadow:0 1px 2px rgba(0,0,0,0.3); }
.ohaeng-count { width:24px; font-size:0.9em; color:#888; }
/* ì‹­ì‹  */
.sipsin-table { width:100%; border-collapse:collapse; }
.sipsin-table th, .sipsin-table td { padding:8px 10px; text-align:center; border:1px solid var(--border); font-size:0.9em; }
.sipsin-table th { background:#F5F0EA; font-weight:600; color:#888; }
/* ëŒ€ìš´ */
.daeun-flow { display:flex; gap:0; overflow-x:auto; padding-bottom:8px; }
.daeun-item { text-align:center; min-width:72px; border:1px solid var(--border); flex-shrink:0; }
.daeun-item .age { background:#F5F0EA; padding:4px 6px; font-size:0.8em; color:#888; border-bottom:1px solid var(--border); }
.daeun-item .stem2, .daeun-item .branch2 { padding:8px 4px; font-size:1.2em; font-weight:700; }
.daeun-item .stem2 { border-bottom:1px solid var(--border); }
/* ìš´ì„¸ */
.fortune-area { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px; }
.fortune-card { background:#FAF6F1; border-radius:8px; padding:14px; border:1px solid var(--border); }
.fortune-card h4 { font-size:0.95em; color:var(--accent); margin-bottom:6px; }
.fortune-card p { font-size:0.88em; color:#555; }
.personality-box { background:#FAF6F1; border-radius:8px; padding:16px; border-left:4px solid var(--gold); margin:8px 0; }
.personality-box p { font-size:0.92em; color:#555; }
.analysis-text { font-size:0.9em; color:#555; margin-top:10px; line-height:1.7; }
.footer { text-align:center; padding:30px 0 20px; color:#bbb; font-size:0.8em; }
@media (max-width:600px) {
  .form-row { flex-direction:column; }
  .form-group { min-width:auto; }
  .fortune-area { grid-template-columns:1fr !important; }
  .pillar { min-width:70px; }
  .pillar .stem, .pillar .branch { font-size:1.4em; padding:10px 4px; }
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ì‚¬ì£¼íŒ”ì<span>å›› æŸ± å…« å­—</span></h1>
    <p>ìƒë…„ì›”ì¼ì‹œë¥¼ ì…ë ¥í•˜ì—¬ ì‚¬ì£¼ëª…ì‹ì„ ë¶„ì„í•©ë‹ˆë‹¤</p>
  </header>
  <div class="form-card">
    <div class="form-row">
      <div class="form-group"><label>ì¶œìƒë…„ë„</label><input type="number" id="year" min="1924" max="2025" value="1990"></div>
      <div class="form-group"><label>ì›”</label><select id="month"></select></div>
      <div class="form-group"><label>ì¼</label><select id="day"></select></div>
      <div class="form-group"><label>ì‹œ(æ™‚)</label><select id="hour"></select></div>
      <div class="form-group"><label>ì„±ë³„</label><select id="gender"><option value="M">ë‚¨ì„±</option><option value="F">ì—¬ì„±</option></select></div>
      <div class="form-group"><label>&nbsp;</label><button class="btn" type="button" onclick="analyze()">ë¶„ì„í•˜ê¸°</button></div>
    </div>
  </div>
  <div id="results">
    <div class="section" id="sec-pillars"><h2>ì‚¬ì£¼ ëª…ì‹ <span class="hanja">å››æŸ±å‘½å¼</span></h2><div id="pillarContent"></div></div>
    <div class="section" id="sec-personality"><h2>ì¼ê°„ ë¶„ì„ <span class="hanja">æ—¥å¹²åˆ†æ</span></h2><div id="personalityContent"></div></div>
    <div class="section" id="sec-ohaeng"><h2>ì˜¤í–‰ ë¶„í¬ <span class="hanja">äº”è¡Œåˆ†å¸ƒ</span></h2><div id="ohaengContent"></div></div>
    <div class="section" id="sec-sipsin"><h2>ì‹­ì‹  ë¶„ì„ <span class="hanja">åç¥åˆ†æ</span></h2><div id="sipsinContent"></div></div>
    <div class="section" id="sec-daeun"><h2>ëŒ€ìš´ <span class="hanja">å¤§é‹</span></h2><div id="daeunContent"></div></div>
    <div class="section" id="sec-fortune-last"><h2>2025 ì„ì‚¬ë…„ ìš´ì„¸ <span class="hanja">ä¹™å·³å¹´é‹å‹¢</span></h2><div id="fortuneLastContent"></div></div>
    <div class="section" id="sec-fortune-this"><h2>2026 ë³‘ì˜¤ë…„ ìš´ì„¸ <span class="hanja">ä¸™åˆå¹´é‹å‹¢</span></h2><div id="fortuneThisContent"></div></div>
    <div class="section" id="sec-fortune-today"><h2>ì˜¤ëŠ˜ì˜ ìš´ì„¸ <span class="hanja">ä»Šæ—¥é‹å‹¢</span></h2><div id="fortuneTodayContent"></div></div>
  </div>
  <div class="footer">ë³¸ ì‚¬ì£¼ ë¶„ì„ì€ ì°¸ê³ ìš©ì´ë©° ì‹¤ì œ ìš´ëª…ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
</div>
<script>
// === Constants ===
const ì²œê°„ = ['ê°‘','ì„','ë³‘','ì •','ë¬´','ê¸°','ê²½','ì‹ ','ì„','ê³„'];
const ì²œê°„í•œì = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
const ì§€ì§€ = ['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'];
const ì§€ì§€í•œì = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
const ì˜¤í–‰ = ['ëª©','í™”','í† ','ê¸ˆ','ìˆ˜'];
const ì˜¤í–‰í•œì = ['æœ¨','ç«','åœŸ','é‡‘','æ°´'];
const ì˜¤í–‰ìƒ‰ = ['var(--wood)','var(--fire)','var(--earth)','var(--metal)','var(--water)'];
const ì˜¤í–‰class = ['el-wood','el-fire','el-earth','el-metal','el-water'];
const ê°„ì˜¤í–‰ = [0,0,1,1,2,2,3,3,4,4]; // ì²œê°„â†’ì˜¤í–‰ index
const ì§€ì˜¤í–‰ = [4,2,0,0,2,1,1,2,3,3,2,4]; // ì§€ì§€â†’ì˜¤í–‰ index (primary)
const ì‹­ì‹ ëª… = ['ë¹„ê²¬','ê²ì¬','ì‹ì‹ ','ìƒê´€','í¸ì¬','ì •ì¬','í¸ê´€','ì •ê´€','í¸ì¸','ì •ì¸'];

const ì§€ì¥ê°„ = [
  [9],       // ì: ê³„
  [5,9,7],   // ì¶•: ê¸°,ê³„,ì‹ 
  [0,2,4],   // ì¸: ê°‘,ë³‘,ë¬´
  [1],       // ë¬˜: ì„
  [4,1,9],   // ì§„: ë¬´,ì„,ê³„
  [2,6,4],   // ì‚¬: ë³‘,ê²½,ë¬´
  [3,5],     // ì˜¤: ì •,ê¸°
  [5,3,1],   // ë¯¸: ê¸°,ì •,ì„
  [6,8,4],   // ì‹ : ê²½,ì„,ë¬´
  [7],       // ìœ : ì‹ 
  [4,7,3],   // ìˆ : ë¬´,ì‹ ,ì •
  [8,0]      // í•´: ì„,ê°‘
];

const ì‹œlabels = [
  'ìì‹œ (23:00~01:00)','ì¶•ì‹œ (01:00~03:00)','ì¸ì‹œ (03:00~05:00)','ë¬˜ì‹œ (05:00~07:00)',
  'ì§„ì‹œ (07:00~09:00)','ì‚¬ì‹œ (09:00~11:00)','ì˜¤ì‹œ (11:00~13:00)','ë¯¸ì‹œ (13:00~15:00)',
  'ì‹ ì‹œ (15:00~17:00)','ìœ ì‹œ (17:00~19:00)','ìˆ ì‹œ (19:00~21:00)','í•´ì‹œ (21:00~23:00)'
];

// ì ˆê¸° boundaries: [calendarMonth, day] for each ì‚¬ì£¼ month
// Index 0=ì¸ì›”, 1=ë¬˜ì›”, ... 11=ì¶•ì›”
const ì ˆê¸°ì›” = [2,3,4,5,6,7,8,9,10,11,12,1];
const ì ˆê¸°ì¼ = [4,6,5,6,6,7,8,8,8,7,7,6];
// ì‚¬ì£¼ month branch indices: ì¸(2),ë¬˜(3),...í•´(11),ì(0),ì¶•(1)
const ì›”ì§€index = [2,3,4,5,6,7,8,9,10,11,0,1];

const ì¼ê°„ì„±ê²© = [
  'ê°‘ëª©(ç”²æœ¨)ì€ í° ë‚˜ë¬´ì™€ ê°™ìŠµë‹ˆë‹¤. ê³§ê³  ì •ì§í•˜ë©° ë¦¬ë”ì‹­ì´ ê°•í•˜ê³ , ì–´ë ¤ìš´ ìƒí™©ì—ì„œë„ êµ½íˆì§€ ì•ŠëŠ” ê°•ì¸í•œ ì˜ì§€ë¥¼ ì§€ë‹™ë‹ˆë‹¤.',
  'ì„ëª©(ä¹™æœ¨)ì€ í’€ì´ë‚˜ ë©êµ´ê³¼ ê°™ìŠµë‹ˆë‹¤. ìœ ì—°í•˜ê³  ì ì‘ë ¥ì´ ë›°ì–´ë‚˜ë©°, ì™¸ìœ ë‚´ê°•ì˜ ê¸°ì§ˆë¡œ í˜‘ë ¥ê³¼ ì¡°í™”ë¥¼ ì¤‘ì‹œí•©ë‹ˆë‹¤.',
  'ë³‘í™”(ä¸™ç«)ëŠ” íƒœì–‘ê³¼ ê°™ìŠµë‹ˆë‹¤. ë°ê³  ì—´ì •ì ì´ë©° ì†”ì§í•˜ê³  ëŒ€ë²”í•œ ê¸°ì§ˆë¡œ, ë”°ëœ»í•œ ë§ˆìŒìœ¼ë¡œ ì£¼ë³€ì— ì—ë„ˆì§€ë¥¼ ì¤ë‹ˆë‹¤.',
  'ì •í™”(ä¸ç«)ëŠ” ì´›ë¶ˆì´ë‚˜ ë“±ë¶ˆê³¼ ê°™ìŠµë‹ˆë‹¤. ì€ì€í•˜ê³  ì„¬ì„¸í•˜ë©° ì˜ˆë¦¬í•œ ì§ê´€ë ¥ì„ ì§€ë‹ˆê³ , ê¹Šì€ ì‚¬ê³ ë¡œ ë³¸ì§ˆì„ ê¿°ëš«ì–´ ë´…ë‹ˆë‹¤.',
  'ë¬´í† (æˆŠåœŸ)ëŠ” í° ì‚°ì´ë‚˜ ëŒ€ì§€ì™€ ê°™ìŠµë‹ˆë‹¤. ë“¬ì§í•˜ê³  í¬ìš©ë ¥ì´ ìˆìœ¼ë©°, ì±…ì„ê°ì´ ê°•í•˜ì—¬ ì£¼ë³€ì˜ ì¤‘ì‹¬ì´ ë©ë‹ˆë‹¤.',
  'ê¸°í† (å·±åœŸ)ëŠ” ë¹„ì˜¥í•œ ë†ê²½ì§€ì™€ ê°™ìŠµë‹ˆë‹¤. ììƒí•˜ê³  í—Œì‹ ì ì´ë©° ì‹¤ìš©ì ì¸ ì„±í–¥ìœ¼ë¡œ, ê¼¼ê¼¼í•˜ê²Œ ë‚´ì‹¤ì„ ë‹¤ì§‘ë‹ˆë‹¤.',
  'ê²½ê¸ˆ(åºšé‡‘)ì€ ê°•ì² ì´ë‚˜ ë°”ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ê°•ì¸í•˜ê³  ê²°ë‹¨ë ¥ì´ ìˆìœ¼ë©°, ì˜ë¦¬ë¥¼ ì¤‘ì‹œí•˜ê³  ë„ì „ì •ì‹ ì´ ë„˜ì¹©ë‹ˆë‹¤.',
  'ì‹ ê¸ˆ(è¾›é‡‘)ì€ ë³´ì„ì´ë‚˜ ê·€ê¸ˆì†ê³¼ ê°™ìŠµë‹ˆë‹¤. ì„¸ë ¨ë˜ê³  ê°ê°ì ì´ë©°, ìê¸°ë§Œì˜ í™•ê³ í•œ ê¸°ì¤€ìœ¼ë¡œ ì™„ë²½ì„ ì¶”êµ¬í•©ë‹ˆë‹¤.',
  'ì„ìˆ˜(å£¬æ°´)ëŠ” í° ë°”ë‹¤ë‚˜ ê°•ê³¼ ê°™ìŠµë‹ˆë‹¤. ë„“ì€ ë„ëŸ‰ê³¼ ì§€í˜œë¥¼ ì§€ë‹ˆë©°, ì§„ì·¨ì ì´ê³  í¬ìš©ë ¥ì´ í° ììœ ë¡œìš´ ì˜í˜¼ì…ë‹ˆë‹¤.',
  'ê³„ìˆ˜(ç™¸æ°´)ëŠ” ì´ìŠ¬ì´ë‚˜ ë¹—ë¬¼ê³¼ ê°™ìŠµë‹ˆë‹¤. ì„¬ì„¸í•˜ê³  ì§ê´€ì ì´ë©°, ì¡°ìš©í•˜ì§€ë§Œ ëˆê¸° ìˆê²Œ í•™ë¬¸ê³¼ ì˜ˆìˆ ì— ì¬ëŠ¥ì„ ë³´ì…ë‹ˆë‹¤.'
];

// === Init Form ===
(function initForm() {
  const mSel = document.getElementById('month');
  for (let i = 1; i <= 12; i++) mSel.innerHTML += `<option value="${i}">${i}ì›”</option>`;
  const dSel = document.getElementById('day');
  for (let i = 1; i <= 31; i++) dSel.innerHTML += `<option value="${i}">${i}ì¼</option>`;
  const hSel = document.getElementById('hour');
  ì‹œlabels.forEach((l, i) => hSel.innerHTML += `<option value="${i}">${l}</option>`);
})();

// === Utility ===
function getJDN(y, m, d) {
  let a = Math.floor((14 - m) / 12);
  let yy = y + 4800 - a;
  let mm = m + 12 * a - 3;
  return d + Math.floor((153 * mm + 2) / 5) + 365 * yy + Math.floor(yy / 4) - Math.floor(yy / 100) + Math.floor(yy / 400) - 32045;
}

function getSajuMonthIdx(month, day) {
  // Returns 0=ì¸ì›” .. 11=ì¶•ì›”
  const bounds = [
    [1,6,11],[2,4,0],[3,6,1],[4,5,2],[5,6,3],[6,6,4],
    [7,7,5],[8,8,6],[9,8,7],[10,8,8],[11,7,9],[12,7,10]
  ]; // [calMonth, calDay, sajuMonthIdx]
  let idx = 10; // default: ìì›” (before Jan 6)
  for (let i = bounds.length - 1; i >= 0; i--) {
    if (month > bounds[i][0] || (month === bounds[i][0] && day >= bounds[i][1])) {
      idx = bounds[i][2];
      break;
    }
  }
  return idx;
}

function getSajuYear(year, month, day) {
  // Before ì…ì¶˜ (Feb 4), use previous year
  if (month < 2 || (month === 2 && day < 4)) return year - 1;
  return year;
}

function stemEl(si) { return ê°„ì˜¤í–‰[si]; }
function branchEl(bi) { return ì§€ì˜¤í–‰[bi]; }
function elClass(elIdx) { return ì˜¤í–‰class[elIdx]; }
function stemClass(si) { return elClass(stemEl(si)); }
function branchClass(bi) { return elClass(branchEl(bi)); }

// === Core Calculation ===
function calcSaju(year, month, day, hourBranch) {
  const sajuYear = getSajuYear(year, month, day);
  const sajuMonthIdx = getSajuMonthIdx(month, day);

  // Year pillar
  const yearStem = ((sajuYear - 4) % 10 + 10) % 10;
  const yearBranch = ((sajuYear - 4) % 12 + 12) % 12;

  // Month pillar
  const monthBranch = ì›”ì§€index[sajuMonthIdx];
  const monthStem = ((yearStem % 5) * 2 + 2 + sajuMonthIdx) % 10;

  // Day pillar
  const jdn = getJDN(year, month, day);
  const dayStem = (jdn + 9) % 10;
  const dayBranch = (jdn + 1) % 12;

  // Hour pillar
  const hourStem = ((dayStem % 5) * 2 + hourBranch) % 10;

  return {
    yearStem, yearBranch, monthStem, monthBranch,
    dayStem, dayBranch, hourStem, hourBranch,
    sajuYear, sajuMonthIdx
  };
}

// === ì‹­ì‹  Calculation ===
function getSipsin(dayStemIdx, targetStemIdx) {
  const meEl = stemEl(dayStemIdx);
  const tEl = stemEl(targetStemIdx);
  const meYY = dayStemIdx % 2;
  const tYY = targetStemIdx % 2;
  const sameYY = meYY === tYY;

  const diff = (tEl - meEl + 5) % 5;
  // diff: 0=same, 1=I produce, 2=I control, 3=controls me, 4=produces me
  const map = [
    [0, 1], // same: ë¹„ê²¬(0)/ê²ì¬(1)
    [2, 3], // I produce: ì‹ì‹ (2)/ìƒê´€(3)
    [4, 5], // I control: í¸ì¬(4)/ì •ì¬(5)
    [6, 7], // controls me: í¸ê´€(6)/ì •ê´€(7)
    [8, 9], // produces me: í¸ì¸(8)/ì •ì¸(9)
  ];
  return map[diff][sameYY ? 0 : 1];
}

// === ì˜¤í–‰ Distribution ===
function calcOhaeng(saju) {
  const counts = [0, 0, 0, 0, 0];
  const stems = [saju.yearStem, saju.monthStem, saju.dayStem, saju.hourStem];
  const branches = [saju.yearBranch, saju.monthBranch, saju.dayBranch, saju.hourBranch];
  stems.forEach(s => counts[stemEl(s)]++);
  branches.forEach(b => counts[branchEl(b)]++);
  return counts;
}

// === ëŒ€ìš´ Calculation ===
function calcDaeun(saju, gender, year, month, day) {
  const yearYY = saju.yearStem % 2; // 0=ì–‘, 1=ìŒ
  const isMale = gender === 'M';
  const isForward = (yearYY === 0 && isMale) || (yearYY === 1 && !isMale);

  // Calculate start age
  let targetIdx;
  if (isForward) {
    targetIdx = (saju.sajuMonthIdx + 1) % 12;
  } else {
    targetIdx = saju.sajuMonthIdx;
  }
  const tMonth = ì ˆê¸°ì›”[targetIdx];
  const tDay = ì ˆê¸°ì¼[targetIdx];

  let tYear = year;
  if (isForward) {
    // next ì ˆê¸°
    if (tMonth < month || (tMonth === month && tDay <= day)) {
      tYear = year + 1;
    }
    // handle ì¶•ì›” case (Jan next year)
    if (tMonth === 1 && month >= 2) tYear = year + 1;
  } else {
    // current month's ì ˆê¸° (previous to birth)
    if (tMonth > month || (tMonth === month && tDay > day)) {
      tYear = year - 1;
    }
  }

  const jdnBirth = getJDN(year, month, day);
  const jdnTarget = getJDN(tYear, tMonth, tDay);
  const daysDiff = Math.abs(jdnTarget - jdnBirth);
  let startAge = Math.round(daysDiff / 3);
  if (startAge < 1) startAge = 1;

  // Generate 8 ëŒ€ìš´
  const periods = [];
  for (let i = 1; i <= 8; i++) {
    let stem, branch;
    if (isForward) {
      stem = (saju.monthStem + i) % 10;
      branch = (saju.monthBranch + i) % 12;
    } else {
      stem = ((saju.monthStem - i) % 10 + 10) % 10;
      branch = ((saju.monthBranch - i) % 12 + 12) % 12;
    }
    periods.push({
      stem, branch,
      startAge: startAge + (i - 1) * 10,
      endAge: startAge + i * 10 - 1
    });
  }
  return { startAge, isForward, periods };
}

// === Display Functions ===
function renderPillars(saju) {
  const cols = [
    { label: 'ì‹œì£¼(æ™‚æŸ±)', s: saju.hourStem, b: saju.hourBranch, isDay: false },
    { label: 'ì¼ì£¼(æ—¥æŸ±)', s: saju.dayStem, b: saju.dayBranch, isDay: true },
    { label: 'ì›”ì£¼(æœˆæŸ±)', s: saju.monthStem, b: saju.monthBranch, isDay: false },
    { label: 'ë…„ì£¼(å¹´æŸ±)', s: saju.yearStem, b: saju.yearBranch, isDay: false },
  ];
  // Display right to left (ë…„ ì›” ì¼ ì‹œ) in traditional order
  const ordered = cols.reverse();
  let html = '<div class="pillar-table">';
  ordered.forEach(c => {
    const markerClass = c.isDay ? ' ilgan-marker' : '';
    html += `<div class="pillar">
      <div class="label">${c.label}</div>
      <div class="stem${markerClass}"><span class="${c.isDay ? '' : stemClass(c.s)}">${ì²œê°„[c.s]}</span><span class="sub">${ì²œê°„í•œì[c.s]} ${c.isDay ? '(ì¼ê°„)' : ''}</span></div>
      <div class="branch"><span class="${branchClass(c.b)}">${ì§€ì§€[c.b]}</span><span class="sub">${ì§€ì§€í•œì[c.b]}</span></div>
    </div>`;
  });
  html += '</div>';
  document.getElementById('pillarContent').innerHTML = html;
}

function renderPersonality(saju) {
  const ds = saju.dayStem;
  document.getElementById('personalityContent').innerHTML =
    `<div class="personality-box"><p><strong class="${stemClass(ds)}">${ì²œê°„[ds]}${ì˜¤í–‰[stemEl(ds)]}(${ì²œê°„í•œì[ds]}${ì˜¤í–‰í•œì[stemEl(ds)]})</strong> ì¼ê°„</p><p style="margin-top:8px">${ì¼ê°„ì„±ê²©[ds]}</p></div>`;
}

function renderOhaeng(counts) {
  const max = Math.max(...counts, 1);
  let html = '<div class="ohaeng-chart">';
  counts.forEach((c, i) => {
    const pct = (c / 8) * 100;
    html += `<div class="ohaeng-row">
      <div class="ohaeng-label ${ì˜¤í–‰class[i]}">${ì˜¤í–‰[i]}(${ì˜¤í–‰í•œì[i]})</div>
      <div class="ohaeng-bar-bg"><div class="ohaeng-bar" style="width:${pct}%;background:${ì˜¤í–‰ìƒ‰[i]}"><span>${c}</span></div></div>
      <div class="ohaeng-count">${c}/8</div>
    </div>`;
  });
  html += '</div>';

  // Analysis
  const total = counts.reduce((a, b) => a + b, 0);
  let strong = [], weak = [], missing = [];
  counts.forEach((c, i) => {
    if (c >= 3) strong.push(ì˜¤í–‰[i]);
    else if (c === 0) missing.push(ì˜¤í–‰[i]);
    else if (c === 1) weak.push(ì˜¤í–‰[i]);
  });
  let analysis = '<div class="analysis-text">';
  if (strong.length) analysis += `<strong>${strong.join(', ')}</strong>ì´(ê°€) ê°•í•©ë‹ˆë‹¤. `;
  if (missing.length) analysis += `<strong>${missing.join(', ')}</strong>ì´(ê°€) ì—†ì–´ ë³´ì™„ì´ í•„ìš”í•©ë‹ˆë‹¤. `;
  if (weak.length) analysis += `<strong>${weak.join(', ')}</strong>ì´(ê°€) ë¶€ì¡±í•©ë‹ˆë‹¤. `;
  if (!strong.length && !missing.length) analysis += 'ì˜¤í–‰ì´ ë¹„êµì  ê· í˜• ì¡íŒ ì‚¬ì£¼ì…ë‹ˆë‹¤.';
  analysis += '</div>';
  html += analysis;
  document.getElementById('ohaengContent').innerHTML = html;
}

function renderSipsin(saju) {
  const ds = saju.dayStem;
  const pillars = [
    { name: 'ë…„ì£¼', stem: saju.yearStem, branch: saju.yearBranch },
    { name: 'ì›”ì£¼', stem: saju.monthStem, branch: saju.monthBranch },
    { name: 'ì¼ì£¼', stem: saju.dayStem, branch: saju.dayBranch },
    { name: 'ì‹œì£¼', stem: saju.hourStem, branch: saju.hourBranch },
  ];

  let html = '<table class="sipsin-table"><tr><th></th><th>ë…„ì£¼</th><th>ì›”ì£¼</th><th>ì¼ì£¼</th><th>ì‹œì£¼</th></tr>';

  // ì²œê°„ ì‹­ì‹ 
  html += '<tr><th>ì²œê°„</th>';
  pillars.forEach((p, i) => {
    if (i === 2) { html += '<td style="background:#FFF3E0;font-weight:600">ì¼ê°„(ë‚˜)</td>'; return; }
    const ss = getSipsin(ds, p.stem);
    html += `<td>${ì‹­ì‹ ëª…[ss]}<br><small class="${stemClass(p.stem)}">${ì²œê°„[p.stem]}${ì˜¤í–‰í•œì[stemEl(p.stem)]}</small></td>`;
  });
  html += '</tr>';

  // ì§€ì§€ ì‹­ì‹  (use ì§€ì¥ê°„ main stem)
  html += '<tr><th>ì§€ì§€</th>';
  pillars.forEach((p) => {
    const mainJijanggan = ì§€ì¥ê°„[p.branch][0]; // primary hidden stem
    const ss = getSipsin(ds, mainJijanggan);
    html += `<td>${ì‹­ì‹ ëª…[ss]}<br><small class="${branchClass(p.branch)}">${ì§€ì§€[p.branch]}${ì˜¤í–‰í•œì[branchEl(p.branch)]}</small></td>`;
  });
  html += '</tr></table>';

  // ì‹­ì‹  ìš”ì•½ (ê°€ì¥ ë§ì€ ì‹­ì‹  1ê°œë§Œ í‘œì‹œ)
  const sipsinCounts = {};
  pillars.forEach((p, i) => {
    if (i !== 2) {
      const ss = getSipsin(ds, p.stem);
      sipsinCounts[ì‹­ì‹ ëª…[ss]] = (sipsinCounts[ì‹­ì‹ ëª…[ss]] || 0) + 1;
    }
    const ms = ì§€ì¥ê°„[p.branch][0];
    const ss2 = getSipsin(ds, ms);
    sipsinCounts[ì‹­ì‹ ëª…[ss2]] = (sipsinCounts[ì‹­ì‹ ëª…[ss2]] || 0) + 1;
  });
  const sorted = Object.entries(sipsinCounts).sort((a, b) => b[1] - a[1]);
  if (sorted.length) {
    html += `<div class="analysis-text" style="margin-top:10px">ì£¼ìš” ì‹­ì‹ : <strong>${sorted[0][0]}</strong>(${sorted[0][1]}ê°œ)${sorted.length > 1 ? `, ${sorted[1][0]}(${sorted[1][1]}ê°œ)` : ''}</div>`;
  }

  document.getElementById('sipsinContent').innerHTML = html;
}

function renderDaeun(daeun, saju) {
  const ds = saju.dayStem;
  let html = '<div class="daeun-flow">';
  const currentAge = 2026 - parseInt(document.getElementById('year').value);
  daeun.periods.forEach(p => {
    const isCurrent = currentAge >= p.startAge && currentAge <= p.endAge;
    html += `<div class="daeun-item" style="${isCurrent ? 'background:#FFF3E0;' : ''}">
      <div class="age">${p.startAge}~${p.endAge}ì„¸</div>
      <div class="stem2"><span class="${stemClass(p.stem)}">${ì²œê°„[p.stem]}</span></div>
      <div class="branch2"><span class="${branchClass(p.branch)}">${ì§€ì§€[p.branch]}</span></div>
    </div>`;
  });
  html += '</div>';

  let currentDaeun = null;
  daeun.periods.forEach(p => { if (currentAge >= p.startAge && currentAge <= p.endAge) currentDaeun = p; });
  if (currentDaeun) {
    const ss = getSipsin(ds, currentDaeun.stem);
    html += `<div class="analysis-text" style="margin-top:10px">í˜„ì¬ ë§Œ ${currentAge}ì„¸ â€” <strong>${ì²œê°„[currentDaeun.stem]}${ì§€ì§€[currentDaeun.branch]} ëŒ€ìš´</strong>(${ì‹­ì‹ ëª…[ss]})</div>`;
  }

  document.getElementById('daeunContent').innerHTML = html;
}

// === ìš´ì„¸ ê³µí†µ ë°ì´í„° ===
const ìš´ì„¸ì´í‰ = {
  0: 'ë™ë£Œë‚˜ ê²½ìŸìê°€ ëŠ˜ì–´ë‚˜ëŠ” í•´ì…ë‹ˆë‹¤. ìì‹ ì˜ ì…ì§€ë¥¼ í™•ê³ íˆ í•˜ê³  ë…ìì ì¸ ì—­ëŸ‰ì„ í‚¤ìš°ì„¸ìš”. í˜‘ë ¥ê³¼ ê²½ìŸì˜ ê· í˜•ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.',
  1: 'ë³€í™”ì™€ ë„ì „ì˜ í•´ì…ë‹ˆë‹¤. ì˜ˆìƒì¹˜ ëª»í•œ ì§€ì¶œì´ ìˆì„ ìˆ˜ ìˆìœ¼ë‚˜, ì´ë¥¼ í†µí•´ ìƒˆë¡œìš´ ê¸°íšŒë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ ì—°í•œ ëŒ€ì²˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
  2: 'ì¬ëŠ¥ê³¼ ëŠ¥ë ¥ì„ ë°œíœ˜í•  ê¸°íšŒê°€ ë§ì€ í•´ì…ë‹ˆë‹¤. ìê¸°í‘œí˜„ê³¼ ì°½ì‘ í™œë™ì— ìœ ë¦¬í•˜ë©°, ì—¬ìœ ë¡œìš´ ë§ˆìŒê°€ì§ì´ í–‰ìš´ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.',
  3: 'ì°½ì˜ë ¥ê³¼ í‘œí˜„ë ¥ì´ ë¹›ë‚˜ëŠ” í•´ì…ë‹ˆë‹¤. ê¸°ì¡´ í‹€ì„ ë²—ì–´ë‚œ ìƒˆë¡œìš´ ì‹œë„ê°€ ì¢‹ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ë‹¤ë§Œ ì–¸í–‰ì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
  4: 'ì¬ë¬¼ìš´ì´ í™œë°œí•œ í•´ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ê³³ì—ì„œ ìˆ˜ì…ì´ ë“¤ì–´ì˜¬ ìˆ˜ ìˆìœ¼ë©°, íˆ¬ìë‚˜ ì‚¬ì—… í™•ì¥ì˜ ê¸°íšŒê°€ ìƒê¹ë‹ˆë‹¤. ê³¼ìš•ì€ ê¸ˆë¬¼ì…ë‹ˆë‹¤.',
  5: 'ì•ˆì •ì ì¸ ìˆ˜ì…ê³¼ ì¬ë¬¼ìš´ì´ ê¸°ëŒ€ë˜ëŠ” í•´ì…ë‹ˆë‹¤. ì„±ì‹¤í•˜ê²Œ ë…¸ë ¥í•œ ë§Œí¼ ê²°ì‹¤ì„ ë§ºìŠµë‹ˆë‹¤. ì €ì¶•ê³¼ ì¬í…Œí¬ì— ê´€ì‹¬ì„ ê¸°ìš¸ì´ì„¸ìš”.',
  6: 'ì§ì¥ì´ë‚˜ ì‚¬íšŒì  ì§€ìœ„ì— ë³€í™”ê°€ ìˆì„ ìˆ˜ ìˆëŠ” í•´ì…ë‹ˆë‹¤. ë„ì „ì ì¸ ìƒí™©ì´ ì˜¤ì§€ë§Œ ì´ë¥¼ í†µí•´ ì„±ì¥í•©ë‹ˆë‹¤. ê±´ê°• ê´€ë¦¬ì— ì‹ ê²½ ì“°ì„¸ìš”.',
  7: 'ì‚¬íšŒì  ì¸ì •ê³¼ ìŠ¹ì§„ì˜ ê¸°íšŒê°€ ìˆëŠ” í•´ì…ë‹ˆë‹¤. ê·œìœ¨ê³¼ ì›ì¹™ì„ ì§€í‚¤ë©´ ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ìŠµë‹ˆë‹¤. ì±…ì„ê° ìˆëŠ” í–‰ë™ì´ ë¹›ì„ ë°œí•©ë‹ˆë‹¤.',
  8: 'í•™ë¬¸ì´ë‚˜ ìê¸°ê³„ë°œì— ì¢‹ì€ í•´ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ê¸°ìˆ ì´ë‚˜ ì§€ì‹ì„ ìŠµë“í•˜ê¸°ì— ìœ ë¦¬í•˜ë©°, ë…ì°½ì ì¸ ì•„ì´ë””ì–´ê°€ ë¹›ë‚©ë‹ˆë‹¤.',
  9: 'ê·€ì¸ì˜ ë„ì›€ê³¼ í•™ì—…ìš´ì´ ì¢‹ì€ í•´ì…ë‹ˆë‹¤. ìœ—ì‚¬ëŒì´ë‚˜ ë©˜í† ì˜ ì¡°ì–¸ì— ê·€ ê¸°ìš¸ì´ì„¸ìš”. ìê²©ì¦ ì·¨ë“ì´ë‚˜ í•™ì—…ì— ìœ ë¦¬í•©ë‹ˆë‹¤.'
};

const ì¬ë¬¼ìš´ = {
  0: 'ì¬ë¬¼ ë³€ë™ì´ í¬ì§€ ì•Šìœ¼ë‚˜ ë™ë£Œì™€ì˜ ê¸ˆì „ ê±°ë˜ëŠ” í”¼í•˜ì„¸ìš”.',
  1: 'ê¸‰ì‘ìŠ¤ëŸ¬ìš´ ì§€ì¶œì— ëŒ€ë¹„í•˜ì„¸ìš”. ë³´í—˜ì´ë‚˜ ë¹„ìƒê¸ˆ í™•ë³´ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.',
  2: 'ë¶€ìˆ˜ì…ì´ë‚˜ ë¶€ì—…ì„ í†µí•œ ì¶”ê°€ ìˆ˜ì…ì´ ê¸°ëŒ€ë©ë‹ˆë‹¤.',
  3: 'ì¬ëŠ¥ì„ í™œìš©í•œ ìˆ˜ì… ì°½ì¶œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì°½ì‘ í™œë™ì´ ìœ ë¦¬í•©ë‹ˆë‹¤.',
  4: 'ë‹¤ì–‘í•œ ì¬ë¬¼ ê¸°íšŒê°€ ì°¾ì•„ì˜µë‹ˆë‹¤. ë¶„ì‚° íˆ¬ìê°€ ì¢‹ìŠµë‹ˆë‹¤.',
  5: 'ì•ˆì •ì  ìˆ˜ì…ì´ ìœ ì§€ë©ë‹ˆë‹¤. ì¥ê¸°ì  ì¬í…Œí¬ë¥¼ ì‹œì‘í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.',
  6: 'ì˜ˆê¸°ì¹˜ ì•Šì€ ì§€ì¶œì´ ìˆì„ ìˆ˜ ìˆìœ¼ë‚˜ ê·¹ë³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
  7: 'ì§ì¥ ìˆ˜ì…ì´ ì•ˆì •ì ì´ë©° ë³´ë„ˆìŠ¤ë‚˜ ìŠ¹ê¸‰ì´ ê¸°ëŒ€ë©ë‹ˆë‹¤.',
  8: 'ìê¸°íˆ¬ìì— ë¹„ìš©ì´ ë“¤ì§€ë§Œ ì¥ê¸°ì ìœ¼ë¡œ ì´ë“ì…ë‹ˆë‹¤.',
  9: 'ìœ—ì‚¬ëŒì˜ ë„ì›€ìœ¼ë¡œ ì¬ë¬¼ìš´ì´ ìƒìŠ¹í•©ë‹ˆë‹¤.'
};

const ê±´ê°•ìš´ = {
  0: 'ê³¼ë¡œì— ì£¼ì˜í•˜ì„¸ìš”. ì ì ˆí•œ íœ´ì‹ê³¼ ìš´ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.',
  1: 'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤. ëª…ìƒì´ë‚˜ ìš”ê°€ê°€ ë„ì›€ë©ë‹ˆë‹¤.',
  2: 'ì†Œí™”ê¸° ê±´ê°•ì— ì‹ ê²½ ì“°ì„¸ìš”. ê·œì¹™ì ì¸ ì‹ì‚¬ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.',
  3: 'ì‹¬í˜ˆê´€ ê±´ê°•ì— ì£¼ì˜í•˜ì„¸ìš”. ì •ê¸°ê²€ì§„ì„ ë°›ìœ¼ì„¸ìš”.',
  4: 'í™œë™ëŸ‰ì´ ëŠ˜ì–´ ì²´ë ¥ ì†Œëª¨ê°€ í½ë‹ˆë‹¤. ì˜ì–‘ ì„­ì·¨ì— ì‹ ê²½ ì“°ì„¸ìš”.',
  5: 'ì „ë°˜ì ìœ¼ë¡œ ê±´ê°•í•œ í•´ì…ë‹ˆë‹¤. ê¾¸ì¤€í•œ ìš´ë™ ìŠµê´€ì„ ìœ ì§€í•˜ì„¸ìš”.',
  6: 'ê°„ê³¼ ê·¼ìœ¡ ê±´ê°•ì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë¬´ë¦¬í•˜ì§€ ë§ˆì„¸ìš”.',
  7: 'ê·œì¹™ì ì¸ ìƒí™œ ë¦¬ë“¬ì„ ìœ ì§€í•˜ë©´ ê±´ê°•í•©ë‹ˆë‹¤.',
  8: 'ìˆ˜ë©´ì˜ ì§ˆì„ ë†’ì´ì„¸ìš”. ì¶©ë¶„í•œ íœ´ì‹ì´ íšŒë³µë ¥ì„ ë†’ì…ë‹ˆë‹¤.',
  9: 'ì •ì‹  ê±´ê°•ì´ ì¢‹ìŠµë‹ˆë‹¤. ì—¬í–‰ì´ë‚˜ ë¬¸í™” í™œë™ì´ í™œë ¥ì„ ì¤ë‹ˆë‹¤.'
};

const ëŒ€ì¸ê´€ê³„ = {
  0: 'ë™ë£Œì™€ì˜ ê´€ê³„ê°€ ì¤‘ìš”í•´ì§‘ë‹ˆë‹¤. ì‹ ë¢°ë¥¼ ìŒ“ëŠ” ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.',
  1: 'ì¸ê°„ê´€ê³„ì— ë³€ë™ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§„ì •í•œ ê´€ê³„ë¥¼ êµ¬ë³„í•˜ì„¸ìš”.',
  2: 'ì‚¬êµ í™œë™ì´ í™œë°œí•´ì§€ë©° ì¢‹ì€ ì¸ì—°ì„ ë§Œë‚©ë‹ˆë‹¤.',
  3: 'ì†”ì§í•œ í‘œí˜„ì´ ê´€ê³„ë¥¼ ê°œì„ í•©ë‹ˆë‹¤. ì†Œí†µì— í˜ì“°ì„¸ìš”.',
  4: 'í­ë„“ì€ ì¸ë§¥ í˜•ì„±ì— ìœ ë¦¬í•œ í•´ì…ë‹ˆë‹¤. ëª¨ì„ì— ì ê·¹ ì°¸ì—¬í•˜ì„¸ìš”.',
  5: 'ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë™ë°˜ìë¥¼ ë§Œë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§„ì‹¬ì„ ë³´ì´ì„¸ìš”.',
  6: 'ì§ì¥ ë‚´ ê´€ê³„ì— ë³€í™”ê°€ ìˆìŠµë‹ˆë‹¤. ë¦¬ë”ì‹­ì„ ë°œíœ˜í•  ê¸°íšŒì…ë‹ˆë‹¤.',
  7: 'ì‚¬íšŒì  ëª…ë§ì´ ë†’ì•„ì§‘ë‹ˆë‹¤. ê³µì ì¸ ìë¦¬ì—ì„œ ë¹›ì„ ë°œí•©ë‹ˆë‹¤.',
  8: 'í•™ë¬¸ì  ë™ë£Œë‚˜ ìŠ¤ìŠ¹ê³¼ì˜ ì¸ì—°ì´ ê¹Šì–´ì§‘ë‹ˆë‹¤.',
  9: 'ê·€ì¸ì„ ë§Œë‚˜ëŠ” í•´ì…ë‹ˆë‹¤. ê²¸ì†í•œ íƒœë„ê°€ ê¸°íšŒë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.'
};

const ì§ì—…ìš´ = [
  'í˜„ì¬ ìœ„ì¹˜ë¥¼ ì§€í‚¤ë©° ë‚´ì‹¤ì„ ë‹¤ì§€ì„¸ìš”.',
  'ë³€í™”ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ë§ê³  ìƒˆë¡œìš´ ë„ì „ì„ í•˜ì„¸ìš”.',
  'ì¬ëŠ¥ì„ ì‚´ë¦° ì§ì—… í™œë™ì´ ì¢‹ì€ ê²°ê³¼ë¥¼ ëƒ…ë‹ˆë‹¤.',
  'ì°½ì˜ì ì¸ í”„ë¡œì íŠ¸ì— ì°¸ì—¬í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.',
  'ì‚¬ì—… í™•ì¥ì´ë‚˜ ìƒˆë¡œìš´ ë¶„ì•¼ ì§„ì¶œì´ ìœ ë¦¬í•©ë‹ˆë‹¤.',
  'ì•ˆì •ì ì¸ ì§ì¥ìƒí™œì´ ìœ ì§€ë©ë‹ˆë‹¤.',
  'ìŠ¹ì§„ì´ë‚˜ ë³´ì§ ë³€ê²½ì˜ ê¸°íšŒê°€ ìˆìŠµë‹ˆë‹¤.',
  'ê³µì§ì´ë‚˜ ê´€ë¦¬ì§ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ëƒ…ë‹ˆë‹¤.',
  'ì—°êµ¬, ê°œë°œ ë¶„ì•¼ì—ì„œ ì„±ê³¼ê°€ ê¸°ëŒ€ë©ë‹ˆë‹¤.',
  'êµìœ¡ì´ë‚˜ ìƒë‹´ ë¶„ì•¼ì—ì„œ ë¹›ì„ ë°œí•©ë‹ˆë‹¤.'
];

// === ì‘ë…„ ìš´ì„¸: 2025 ì„ì‚¬ë…„ (ê°„ëµ) ===
function renderFortuneLastYear(saju) {
  const ds = saju.dayStem;
  // 2025 = ì„ì‚¬(ä¹™å·³). ì²œê°„ ì„=1, ì§€ì§€ ì‚¬=5
  const yStem = 1; // ì„
  const yBranch = 5; // ì‚¬
  const ss = getSipsin(ds, yStem);

  let html = `<p class="analysis-text">2025ë…„ <strong class="el-wood">ì„ì‚¬(ä¹™å·³)</strong>ë…„ â€” ì¼ê°„ <strong class="${stemClass(ds)}">${ì²œê°„[ds]}${ì˜¤í–‰í•œì[stemEl(ds)]}</strong>ì—ê²Œ ì„ëª©(ä¹™æœ¨)ì€ <strong>${ì‹­ì‹ ëª…[ss]}</strong></p>`;
  html += `<div class="personality-box" style="margin:10px 0"><p>${ìš´ì„¸ì´í‰[ss]}</p></div>`;
  html += '<div class="analysis-text" style="font-size:0.88em;color:#777">';
  html += `ì¬ë¬¼: ${ì¬ë¬¼ìš´[ss]} / ì§ì—…: ${ì§ì—…ìš´[ss]}<br>`;
  html += `ê±´ê°•: ${ê±´ê°•ìš´[ss]} / ëŒ€ì¸: ${ëŒ€ì¸ê´€ê³„[ss]}`;
  html += '</div>';

  document.getElementById('fortuneLastContent').innerHTML = html;
}

// === ì˜¬í•´ ìš´ì„¸: 2026 ë³‘ì˜¤ë…„ (ìì„¸) ===
function renderFortuneThisYear(saju) {
  const ds = saju.dayStem;
  // 2026 = ë³‘ì˜¤(ä¸™åˆ). ì²œê°„ ë³‘=2, ì§€ì§€ ì˜¤=6
  const yStem = 2; // ë³‘
  const yBranch = 6; // ì˜¤
  const ssStem = getSipsin(ds, yStem);

  let html = `<p class="analysis-text">2026ë…„ì€ <strong class="el-fire">ë³‘ì˜¤(ä¸™åˆ)</strong>ë…„ìœ¼ë¡œ í™”(ç«)ì˜ ê¸°ìš´ì´ ë§¤ìš° ê°•í•œ í•´ì…ë‹ˆë‹¤.</p>`;
  html += `<p class="analysis-text">ì¼ê°„ <strong class="${stemClass(ds)}">${ì²œê°„[ds]}${ì˜¤í–‰í•œì[stemEl(ds)]}</strong>ì—ê²Œ ë³‘í™”(ä¸™ç«)ëŠ” <strong>${ì‹­ì‹ ëª…[ssStem]}</strong>ì— í•´ë‹¹í•©ë‹ˆë‹¤.</p>`;
  html += `<div class="personality-box" style="margin:14px 0"><p>${ìš´ì„¸ì´í‰[ssStem]}</p></div>`;
  html += '<div class="fortune-area">';
  html += `<div class="fortune-card"><h4>ğŸ’° ì¬ë¬¼ìš´</h4><p>${ì¬ë¬¼ìš´[ssStem]}</p></div>`;
  html += `<div class="fortune-card"><h4>ğŸ’ª ê±´ê°•ìš´</h4><p>${ê±´ê°•ìš´[ssStem]}</p></div>`;
  html += `<div class="fortune-card"><h4>ğŸ¤ ëŒ€ì¸ê´€ê³„</h4><p>${ëŒ€ì¸ê´€ê³„[ssStem]}</p></div>`;
  html += `<div class="fortune-card"><h4>ğŸ’¼ ì§ì—…ìš´</h4><p>${ì§ì—…ìš´[ssStem]}</p></div>`;
  html += '</div>';

  // ì›”ë³„ ìš´ì„¸ ê°„ëµ í‘œ (1~12ì›”)
  html += '<h3 style="font-size:1em;color:var(--accent);margin-top:20px;margin-bottom:10px">ì›”ë³„ ìš´ì„¸</h3>';
  html += '<table class="sipsin-table"><tr><th>ì›”</th><th>ê°„ì§€</th><th>ì‹­ì‹ </th><th>í‚¤ì›Œë“œ</th></tr>';
  const ì›”ë³„í‚¤ì›Œë“œ = {
    0: 'ìë¦½Â·ê²½ìŸ', 1: 'ë³€í™”Â·ëŒíŒŒ', 2: 'í‘œí˜„Â·ì¬ëŠ¥', 3: 'ì°½ì˜Â·í˜ì‹ ',
    4: 'ì¬ë¬¼Â·íˆ¬ì', 5: 'ì•ˆì •Â·ì €ì¶•', 6: 'ë„ì „Â·ì„±ì¥', 7: 'ëª…ì˜ˆÂ·ìŠ¹ì§„',
    8: 'í•™ìŠµÂ·íƒêµ¬', 9: 'ê·€ì¸Â·ì§€í˜œ'
  };
  for (let m = 1; m <= 12; m++) {
    // 2026ë…„ ê° ì›”ì˜ ì²œê°„ì§€ì§€ ê³„ì‚° (ì¸ì›” ì‹œì‘)
    // 2026ë…„ ì—°ê°„: ë³‘(2). ì›”ê°„ = (ì—°ê°„%5)*2 + 2 + ì‚¬ì£¼ì›”ì¸ë±ìŠ¤
    const sajuMonthIdx = getSajuMonthIdx(m, 15); // ì›” ì¤‘ìˆœ ê¸°ì¤€
    const mBranch = ì›”ì§€index[sajuMonthIdx];
    // 2026 ì‚¬ì£¼ë…„: ì…ì¶˜ í›„ì´ë¯€ë¡œ yearStem=2
    const mStem = ((2 % 5) * 2 + 2 + sajuMonthIdx) % 10;
    const mSS = getSipsin(ds, mStem);
    html += `<tr><td>${m}ì›”</td><td class="${stemClass(mStem)}">${ì²œê°„[mStem]}${ì§€ì§€[mBranch]}</td><td>${ì‹­ì‹ ëª…[mSS]}</td><td>${ì›”ë³„í‚¤ì›Œë“œ[mSS]}</td></tr>`;
  }
  html += '</table>';

  document.getElementById('fortuneThisContent').innerHTML = html;
}

// === ì˜¤ëŠ˜ì˜ ìš´ì„¸ ===
function renderFortuneToday(saju) {
  const ds = saju.dayStem;
  // ì˜¤ëŠ˜ ë‚ ì§œì˜ ì¼ì§„ ê³„ì‚°
  const today = new Date();
  const tY = today.getFullYear(), tM = today.getMonth() + 1, tD = today.getDate();
  const jdn = getJDN(tY, tM, tD);
  const todayStem = (jdn + 9) % 10;
  const todayBranch = (jdn + 1) % 12;
  const todaySS = getSipsin(ds, todayStem);

  const ì¼ìš´ì´í‰ = {
    0: 'ìì‹ ì˜ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•œ ë‚ ì…ë‹ˆë‹¤. ì£¼ë³€ ê²½ìŸì— íœ˜ë‘˜ë¦¬ì§€ ë§ˆì„¸ìš”.',
    1: 'ì˜ˆìƒì¹˜ ëª»í•œ ë³€í™”ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•˜ë©´ ì˜¤íˆë ¤ ê¸°íšŒê°€ ë©ë‹ˆë‹¤.',
    2: 'ìê¸°í‘œí˜„ì— ìœ ë¦¬í•œ ë‚ ì…ë‹ˆë‹¤. ì•„ì´ë””ì–´ë¥¼ ì ê·¹ì ìœ¼ë¡œ ì œì‹œí•´ ë³´ì„¸ìš”.',
    3: 'ì°½ì˜ì ì¸ ì—ë„ˆì§€ê°€ ë„˜ì¹˜ëŠ” ë‚ ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì‹œë„ì— ì¢‹ìœ¼ë‚˜ ë§ì¡°ì‹¬ì´ í•„ìš”í•©ë‹ˆë‹¤.',
    4: 'ì¬ë¬¼ìš´ì´ ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤. ì‡¼í•‘ì´ë‚˜ íˆ¬ì ì •ë³´ì— ê´€ì‹¬ì„ ê¸°ìš¸ì—¬ ë³´ì„¸ìš”.',
    5: 'ì•ˆì •ì ì´ê³  í‰í™”ë¡œìš´ í•˜ë£¨ì…ë‹ˆë‹¤. ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ë¹›ì„ ë°œí•©ë‹ˆë‹¤.',
    6: 'ë„ì „ì ì¸ ìƒí™©ì´ ì˜¬ ìˆ˜ ìˆìœ¼ë‚˜ ì¹¨ì°©í•˜ê²Œ ëŒ€ì‘í•˜ë©´ ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ìŠµë‹ˆë‹¤.',
    7: 'ì‚¬íšŒì  í™œë™ì— ìœ ë¦¬í•œ ë‚ ì…ë‹ˆë‹¤. ê³µì ì¸ ë§Œë‚¨ì´ë‚˜ ë¯¸íŒ…ì—ì„œ ì¢‹ì€ ì¸ìƒì„ ì¤ë‹ˆë‹¤.',
    8: 'í•™ìŠµê³¼ ìê¸°ê³„ë°œì— ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì •ë³´ë‚˜ ê¸°ìˆ ì„ ìµíˆì„¸ìš”.',
    9: 'ê·€ì¸ì˜ ë„ì›€ì´ ìˆëŠ” ë‚ ì…ë‹ˆë‹¤. ì¡°ì–¸ì— ê·€ ê¸°ìš¸ì´ë©´ í° ë„ì›€ì´ ë©ë‹ˆë‹¤.'
  };

  // í–‰ìš´ ì •ë³´ (ì‹­ì‹  ê¸°ë°˜)
  const í–‰ìš´ìƒ‰ = ['ë…¹ìƒ‰Â·í°ìƒ‰', 'ì²­ìƒ‰Â·ì€ìƒ‰', 'ë¹¨ê°•Â·ì£¼í™©', 'ë³´ë¼Â·ë¶„í™', 'ë…¸ë‘Â·ê¸ˆìƒ‰', 'ë² ì´ì§€Â·í¬ë¦¼', 'ê²€ì •Â·ë‚¨ìƒ‰', 'í°ìƒ‰Â·íšŒìƒ‰', 'íŒŒë‘Â·ë³´ë¼', 'ì—°ë‘Â·ë¯¼íŠ¸'];
  const í–‰ìš´ë°©ìœ„ = ['ë™ìª½', 'ë™ë‚¨ìª½', 'ë‚¨ìª½', 'ë‚¨ì„œìª½', 'ì¤‘ì•™', 'ì„œë‚¨ìª½', 'ì„œìª½', 'ì„œë¶ìª½', 'ë¶ìª½', 'ë¶ë™ìª½'];
  const í–‰ìš´ìˆ«ì = ['3, 8', '2, 7', '3, 4', '9, 0', '5, 6', '1, 6', '4, 9', '1, 2', '6, 7', '5, 0'];

  const dateStr = `${tY}ë…„ ${tM}ì›” ${tD}ì¼`;

  let html = `<p class="analysis-text">${dateStr} â€” ì˜¤ëŠ˜ì˜ ì¼ì§„: <strong class="${stemClass(todayStem)}">${ì²œê°„[todayStem]}${ì§€ì§€[todayBranch]}(${ì²œê°„í•œì[todayStem]}${ì§€ì§€í•œì[todayBranch]})</strong></p>`;
  html += `<p class="analysis-text">ì¼ê°„ <strong class="${stemClass(ds)}">${ì²œê°„[ds]}${ì˜¤í–‰í•œì[stemEl(ds)]}</strong> ê¸°ì¤€ ì˜¤ëŠ˜ì€ <strong>${ì‹­ì‹ ëª…[todaySS]}</strong>ì˜ ê¸°ìš´</p>`;
  html += `<div class="personality-box" style="margin:10px 0"><p>${ì¼ìš´ì´í‰[todaySS]}</p></div>`;
  html += '<div class="fortune-area" style="grid-template-columns:1fr 1fr 1fr">';
  html += `<div class="fortune-card"><h4>ğŸ¨ í–‰ìš´ì˜ ìƒ‰</h4><p>${í–‰ìš´ìƒ‰[todaySS]}</p></div>`;
  html += `<div class="fortune-card"><h4>ğŸ§­ í–‰ìš´ì˜ ë°©ìœ„</h4><p>${í–‰ìš´ë°©ìœ„[todaySS]}</p></div>`;
  html += `<div class="fortune-card"><h4>ğŸ”¢ í–‰ìš´ì˜ ìˆ«ì</h4><p>${í–‰ìš´ìˆ«ì[todaySS]}</p></div>`;
  html += '</div>';

  document.getElementById('fortuneTodayContent').innerHTML = html;
}

// === Main ===
function analyze() {
  const year = parseInt(document.getElementById('year').value);
  const month = parseInt(document.getElementById('month').value);
  const day = parseInt(document.getElementById('day').value);
  const hour = parseInt(document.getElementById('hour').value);
  const gender = document.getElementById('gender').value;

  // Validate date
  const testDate = new Date(year, month - 1, day);
  if (testDate.getMonth() !== month - 1 || testDate.getDate() !== day) {
    alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œì…ë‹ˆë‹¤.');
    return;
  }
  if (year < 1924 || year > 2025) {
    alert('1924ë…„ë¶€í„° 2025ë…„ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    return;
  }

  const saju = calcSaju(year, month, day, hour);
  const ohaeng = calcOhaeng(saju);
  const daeun = calcDaeun(saju, gender, year, month, day);

  renderPillars(saju);
  renderPersonality(saju);
  renderOhaeng(ohaeng);
  renderSipsin(saju);
  renderDaeun(daeun, saju);
  renderFortuneLastYear(saju);
  renderFortuneThisYear(saju);
  renderFortuneToday(saju);

  document.getElementById('results').style.display = 'block';
  document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
}
</script>
</body>
</html>
